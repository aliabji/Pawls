{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"onMomentumScrollEnd\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport React, { useCallback, useContext, useMemo, useEffect } from 'react';\nimport TabBarContext from \"./TabBarContext\";\nimport Reanimated, { runOnJS, useAnimatedReaction, useAnimatedRef, useAnimatedScrollHandler, useSharedValue } from 'react-native-reanimated';\nimport { Constants } from \"../../commons/new\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar FIX_RTL = Constants.isRTL && Constants.isAndroid;\n\nfunction PageCarousel(props) {\n  var onMomentumScrollEnd = props.onMomentumScrollEnd,\n      others = _objectWithoutProperties(props, _excluded);\n\n  var carousel = useAnimatedRef();\n\n  var _useContext = useContext(TabBarContext),\n      itemsCount = _useContext.itemsCount,\n      currentPage = _useContext.currentPage,\n      targetPage = _useContext.targetPage,\n      pageWidth = _useContext.pageWidth,\n      setCurrentIndex = _useContext.setCurrentIndex;\n\n  var initialOffset = useMemo(function () {\n    return {\n      x: currentPage.value * pageWidth,\n      y: 0\n    };\n  }, []);\n  var indexChangeReason = useSharedValue(undefined);\n  var scrollToInitial = useCallback(function () {\n    if (Constants.isAndroid && currentPage.value) {\n      scrollToItem(currentPage.value);\n    }\n  }, []);\n  var calcOffset = useCallback(function () {\n    var _f = function _f(offset) {\n      return FIX_RTL ? pageWidth * (itemsCount - 1) - offset : offset;\n    };\n\n    _f._closure = {\n      FIX_RTL: FIX_RTL,\n      pageWidth: pageWidth,\n      itemsCount: itemsCount\n    };\n    _f.asString = \"function _f(offset){const{FIX_RTL,pageWidth,itemsCount}=jsThis._closure;{return FIX_RTL?pageWidth*(itemsCount-1)-offset:offset;}}\";\n    _f.__workletHash = 10908163045796;\n    _f.__location = \"/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js (36:33)\";\n\n    global.__reanimatedWorkletInit(_f);\n\n    return _f;\n  }(), [pageWidth, itemsCount]);\n  var scrollHandler = useAnimatedScrollHandler({\n    onScroll: function () {\n      var _f = function _f(e) {\n        var xOffset = calcOffset(e.contentOffset.x);\n        var newIndex = xOffset / pageWidth;\n\n        if (indexChangeReason.value === 'byPress') {\n          indexChangeReason.value = undefined;\n        } else {\n          targetPage.value = newIndex;\n        }\n      };\n\n      _f._closure = {\n        calcOffset: calcOffset,\n        pageWidth: pageWidth,\n        indexChangeReason: indexChangeReason,\n        targetPage: targetPage\n      };\n      _f.asString = \"function _f(e){const{calcOffset,pageWidth,indexChangeReason,targetPage}=jsThis._closure;{const xOffset=calcOffset(e.contentOffset.x);const newIndex=xOffset/pageWidth;if(indexChangeReason.value==='byPress'){indexChangeReason.value=undefined;}else{targetPage.value=newIndex;}}}\";\n      _f.__workletHash = 2914680801226;\n      _f.__location = \"/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js (42:14)\";\n\n      global.__reanimatedWorkletInit(_f);\n\n      return _f;\n    }(),\n    onMomentumEnd: function () {\n      var _f = function _f(e) {\n        var xOffset = calcOffset(e.contentOffset.x);\n        var newPage = Math.round(xOffset / pageWidth);\n        indexChangeReason.value = 'byScroll';\n        setCurrentIndex(newPage);\n      };\n\n      _f._closure = {\n        calcOffset: calcOffset,\n        pageWidth: pageWidth,\n        indexChangeReason: indexChangeReason,\n        setCurrentIndex: setCurrentIndex\n      };\n      _f.asString = \"function _f(e){const{calcOffset,pageWidth,indexChangeReason,setCurrentIndex}=jsThis._closure;{const xOffset=calcOffset(e.contentOffset.x);const newPage=Math.round(xOffset/pageWidth);indexChangeReason.value='byScroll';setCurrentIndex(newPage);}}\";\n      _f.__workletHash = 2370503116587;\n      _f.__location = \"/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js (57:19)\";\n\n      global.__reanimatedWorkletInit(_f);\n\n      return _f;\n    }()\n  });\n  var scrollToItem = useCallback(function (index) {\n    var _carousel$current;\n\n    if (indexChangeReason.value === 'byScroll') {\n      indexChangeReason.value = undefined;\n    } else {\n      indexChangeReason.value = 'byPress';\n    }\n\n    var actualIndex = FIX_RTL ? itemsCount - index - 1 : index;\n    (_carousel$current = carousel.current) == null ? void 0 : _carousel$current.scrollTo({\n      x: actualIndex * pageWidth,\n      animated: false\n    });\n  }, [pageWidth, itemsCount]);\n  useAnimatedReaction(function () {\n    var _f = function _f() {\n      return currentPage.value;\n    };\n\n    _f._closure = {\n      currentPage: currentPage\n    };\n    _f.asString = \"function _f(){const{currentPage}=jsThis._closure;{return currentPage.value;}}\";\n    _f.__workletHash = 16845019634419;\n    _f.__location = \"/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js (77:22)\";\n\n    global.__reanimatedWorkletInit(_f);\n\n    return _f;\n  }(), function () {\n    var _f = function _f(currIndex, prevIndex) {\n      if (prevIndex !== null && currIndex !== prevIndex) {\n        runOnJS(scrollToItem)(currIndex);\n      }\n    };\n\n    _f._closure = {\n      runOnJS: runOnJS,\n      scrollToItem: scrollToItem\n    };\n    _f.asString = \"function _f(currIndex,prevIndex){const{runOnJS,scrollToItem}=jsThis._closure;{if(prevIndex!==null&&currIndex!==prevIndex){runOnJS(scrollToItem)(currIndex);}}}\";\n    _f.__workletHash = 6988859797192;\n    _f.__location = \"/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js (79:5)\";\n\n    global.__reanimatedWorkletInit(_f);\n\n    return _f;\n  }());\n  useEffect(function () {\n    var _carousel$current2;\n\n    (_carousel$current2 = carousel.current) == null ? void 0 : _carousel$current2.scrollTo({\n      x: currentPage.value * pageWidth,\n      animated: false\n    });\n  }, [pageWidth]);\n  var handleOnMomentumScrollEnd = useCallback(function (event) {\n    onMomentumScrollEnd == null ? void 0 : onMomentumScrollEnd(event);\n  }, [onMomentumScrollEnd]);\n  return _jsx(Reanimated.ScrollView, _objectSpread(_objectSpread({}, others), {}, {\n    ref: carousel,\n    horizontal: true,\n    pagingEnabled: true,\n    showsHorizontalScrollIndicator: false,\n    onScroll: scrollHandler,\n    scrollEventThrottle: 16,\n    contentOffset: initialOffset,\n    onLayout: scrollToInitial,\n    onMomentumScrollEnd: handleOnMomentumScrollEnd\n  }));\n}\n\nexport default PageCarousel;","map":{"version":3,"sources":["/Users/aliabji/code/dogs/Pawls/node_modules/react-native-ui-lib/src/components/tabController/PageCarousel.js"],"names":["React","useCallback","useContext","useMemo","useEffect","TabBarContext","Reanimated","runOnJS","useAnimatedReaction","useAnimatedRef","useAnimatedScrollHandler","useSharedValue","Constants","FIX_RTL","isRTL","isAndroid","PageCarousel","props","onMomentumScrollEnd","others","carousel","itemsCount","currentPage","targetPage","pageWidth","setCurrentIndex","initialOffset","x","value","y","indexChangeReason","undefined","scrollToInitial","scrollToItem","calcOffset","offset","scrollHandler","onScroll","e","xOffset","contentOffset","newIndex","onMomentumEnd","newPage","Math","round","index","actualIndex","current","scrollTo","animated","currIndex","prevIndex","handleOnMomentumScrollEnd","event"],"mappings":"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","sourcesContent":["import React, { useCallback, useContext, useMemo, useEffect } from 'react';\nimport TabBarContext from \"./TabBarContext\";\nimport Reanimated, { runOnJS, useAnimatedReaction, useAnimatedRef, useAnimatedScrollHandler, useSharedValue } from 'react-native-reanimated';\nimport { Constants } from \"../../commons/new\";\nconst FIX_RTL = Constants.isRTL && Constants.isAndroid;\n/**\n * @description: TabController's Page Carousel\n * @example: https://github.com/wix/react-native-ui-lib/blob/master/demo/src/screens/componentScreens/TabControllerScreen/index.tsx\n * @notes: You must pass `asCarousel` flag to TabController and render your TabPages inside a PageCarousel\n */\n\nfunction PageCarousel(props) {\n  const {\n    onMomentumScrollEnd,\n    ...others\n  } = props;\n  const carousel = useAnimatedRef();\n  const {\n    itemsCount,\n    currentPage,\n    targetPage,\n    pageWidth,\n    // carouselOffset,\n    setCurrentIndex\n  } = useContext(TabBarContext);\n  const initialOffset = useMemo(() => ({\n    x: currentPage.value * pageWidth,\n    y: 0\n  }), []);\n  const indexChangeReason = useSharedValue(undefined);\n  const scrollToInitial = useCallback(() => {\n    if (Constants.isAndroid && currentPage.value) {\n      scrollToItem(currentPage.value);\n    }\n  }, []);\n  const calcOffset = useCallback(offset => {\n    'worklet';\n\n    return FIX_RTL ? pageWidth * (itemsCount - 1) - offset : offset;\n  }, [pageWidth, itemsCount]);\n  const scrollHandler = useAnimatedScrollHandler({\n    onScroll: e => {\n      // carouselOffset.value = e.contentOffset.x;\n      const xOffset = calcOffset(e.contentOffset.x);\n      const newIndex = xOffset / pageWidth;\n\n      if (indexChangeReason.value === 'byPress') {\n        // Scroll was immediate and not by gesture\n\n        /* Round is for android when offset value has fraction */\n        // targetPage.value = withTiming(Math.round(newIndex));\n        indexChangeReason.value = undefined;\n      } else {\n        targetPage.value = newIndex;\n      }\n    },\n    onMomentumEnd: e => {\n      const xOffset = calcOffset(e.contentOffset.x);\n      const newPage = Math.round(xOffset / pageWidth);\n      indexChangeReason.value = 'byScroll';\n      setCurrentIndex(newPage);\n    }\n  });\n  const scrollToItem = useCallback(index => {\n    if (indexChangeReason.value === 'byScroll') {\n      indexChangeReason.value = undefined;\n    } else {\n      indexChangeReason.value = 'byPress';\n    }\n\n    const actualIndex = FIX_RTL ? itemsCount - index - 1 : index;\n    carousel.current?.scrollTo({\n      x: actualIndex * pageWidth,\n      animated: false\n    });\n  }, [pageWidth, itemsCount]);\n  useAnimatedReaction(() => {\n    return currentPage.value;\n  }, (currIndex, prevIndex) => {\n    if (prevIndex !== null && currIndex !== prevIndex) {\n      runOnJS(scrollToItem)(currIndex);\n    }\n  });\n  useEffect(() => {\n    carousel.current?.scrollTo({\n      x: currentPage.value * pageWidth,\n      animated: false\n    });\n  }, [pageWidth]);\n  const handleOnMomentumScrollEnd = useCallback(event => {\n    onMomentumScrollEnd?.(event);\n  }, [onMomentumScrollEnd]);\n  return <Reanimated.ScrollView {...others} ref={carousel} horizontal pagingEnabled showsHorizontalScrollIndicator={false} onScroll={scrollHandler} scrollEventThrottle={16} contentOffset={initialOffset} // iOS only\n  onLayout={scrollToInitial} // Android only\n  onMomentumScrollEnd={handleOnMomentumScrollEnd} // TODO: workaround for useAnimatedScrollHandler.onMomentumEnd not being called (https://github.com/software-mansion/react-native-reanimated/issues/2735)\n  />;\n}\n\nexport default PageCarousel;"]},"metadata":{},"sourceType":"module"}